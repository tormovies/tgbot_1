# Мониторинг бота: чтобы не погас

Есть два подхода: **cron-сторож** (проверяет раз в N минут и запускает, если процесса нет) и **systemd** (сервис с автоперезапуском и стартом при загрузке сервера).

---

## 1. Cron-сторож (подходит для любого сервера)

Скрипт проверяет, запущен ли процесс бота; если нет — запускает.

### 1.1. Скрипт уже в репозитории: `bot-watchdog.sh`

На сервере отредактируй путь в скрипте (если у тебя не website.com.ru):

```bash
nano /home/admin/domains/website.com.ru/public_html/tgbot98/bot-watchdog.sh
```

В первой строке с `BOT_DIR=` укажи свой путь к папке бота. Сохрани.

Сделай скрипт исполняемым:

```bash
chmod +x /home/admin/domains/website.com.ru/public_html/tgbot98/bot-watchdog.sh
```

### 1.2. Запускать по cron каждые 5 минут

```bash
crontab -e
```

Добавь строку (подставь свой путь к папке бота):

```
*/5 * * * * /home/admin/domains/website.com.ru/public_html/tgbot98/bot-watchdog.sh
```

Сохрани и выйди. Так каждые 5 минут будет проверка: если бота нет — он запустится.

Проверить, что задание добавилось:

```bash
crontab -l
```

---

## 2. Systemd (автоперезапуск и старт при загрузке, обычно VPS/свой сервер)

Если есть root и systemd, можно сделать сервис: при падении бота он перезапустится, при перезагрузке сервера — запустится сам.

### 2.1. Создать unit-файл

```bash
sudo nano /etc/systemd/system/tgbot98.service
```

Содержимое (путь замени на свой):

```ini
[Unit]
Description=Telegram dream bot (tgbot98)
After=network.target

[Service]
Type=simple
User=admin
WorkingDirectory=/home/admin/domains/website.com.ru/public_html/tgbot98
ExecStart=/usr/bin/php bot.php
Restart=always
RestartSec=10
StandardOutput=append:/home/admin/domains/website.com.ru/public_html/tgbot98/data/bot.log
StandardError=append:/home/admin/domains/website.com.ru/public_html/tgbot98/data/bot.log

[Install]
WantedBy=multi-user.target
```

Замени **User=** и **WorkingDirectory** на свои, если нужно. Сохрани.

### 2.2. Включить и запустить

```bash
sudo systemctl daemon-reload
sudo systemctl enable tgbot98
sudo systemctl start tgbot98
sudo systemctl status tgbot98
```

Дальше бот управляется так:

- статус: `sudo systemctl status tgbot98`
- перезапуск: `sudo systemctl restart tgbot98`
- остановка: `sudo systemctl stop tgbot98`

После перезагрузки сервера сервис поднимется сам.

---

## 3. Быстрая ручная проверка

Проверить, что процесс есть:

```bash
pgrep -af bot.php
```

Последние строки лога:

```bash
tail -20 /home/admin/domains/website.com.ru/public_html/tgbot98/data/bot.log
```

Если поставил cron-сторож — при следующей «смерти» бота он появится снова в течение 5 минут, и в лог добавится строка вида: `Bot was down, started.`
