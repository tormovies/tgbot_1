# Перенос бота на другой сервер

Токен бота и ключ DeepSeek **не привязаны к серверу** — их переносить не нужно, просто укажешь те же значения в конфиге на новом сервере. Адрес сайта/админки будет новый.

---

## 1. На новом сервере: поставить код и конфиг

### 1.1. Положить файлы

**Если есть SSH и git:**
```bash
cd /путь/к/корню/сайта
# Например: cd ~/public_html  или  cd /var/www/новый-домен.ru/public_html
git clone https://github.com/tormovies/tgbot_1.git tgbot98
cd tgbot98
```

**Если без git:** скачай ZIP с https://github.com/tormovies/tgbot_1, распакуй в папку **tgbot98** в корне сайта на новом сервере.

### 1.2. Создать config.php

```bash
cd tgbot98
cp config.sample.php config.php
nano config.php
```

Заполни **те же значения**, что и на старом сервере:
- **BOT_TOKEN** — тот же токен от @BotFather (бот остаётся тем же)
- **DEEPSEEK_API_KEY** — тот же ключ
- **ADMIN_LOGIN** и **ADMIN_PASSWORD** — логин/пароль для админки (можно оставить или сменить)
- При необходимости: **DATA_DIR**, **LOGS_ARCHIVE_AFTER**, тексты **BOT_MSG_***  

Сохрани файл.

### 1.3. Права на папку data

```bash
chmod 755 data
# Если знаешь пользователя веб-сервера (apache, www-data и т.п.):
chown -R www-data:www-data data
```

### 1.4. Запустить бота

```bash
cd /полный/путь/к/tgbot98
nohup php bot.php >> data/bot.log 2>&1 &
```

Проверка: `pgrep -af bot.php` — должна быть строка с `php bot.php`.

---

## 2. Админка на новом сервере

Админка будет по **новому адресу**, например:
- было: `http://bot.snovidec.ru/tgbot98/admin/`
- станет: `https://новый-домен.ru/tgbot98/admin/` (или как у тебя настроен путь)

Ничего в коде менять не нужно — просто открой в браузере новый URL и войди теми же логином и паролем из **config.php**.

---

## 3. (По желанию) Перенести старые логи

Если нужны логи и расшифровки со старого сервера:

1. На **старом** сервере скопируй файл базы и при необходимости лог:
   ```bash
   # На старом сервере
   cd ~/bot.snovidec.ru/public_html/tgbot98
   tar czf tgbot98-data.tar.gz data/
   ```
   Скачай `tgbot98-data.tar.gz` (через scp/sftp или панель).

2. На **новом** сервере положи архив в папку бота, распакуй:
   ```bash
   cd /путь/к/tgbot98
   tar xzf tgbot98-data.tar.gz
   ```
   Так в `data/` окажутся старые `bot.sqlite` и логи. Если база уже была создана — можно заменить только `data/bot.sqlite` своим файлом со старого сервера.

---

## 4. На старом сервере: выключить бота

Когда убедишься, что на новом сервере бот отвечает в Telegram и админка открывается:

```bash
ssh старый-сервер
pkill -f "php bot.php"
```

Дальше можно не трогать старую папку или удалить её при необходимости.

---

## 5. Что не нужно менять

- **Telegram:** тот же бот, тот же @username — пользователи пишут как раньше.
- **BotFather:** ничего не настраивать.
- **DeepSeek:** тот же API-ключ в config.

Меняется только **сервер**, где лежат файлы и где запущен `php bot.php`, и **адрес админки** (новый домен/путь).

---

## Краткий чек-лист

| Шаг | Действие |
|-----|----------|
| 1 | На новом сервере: git clone или залить файлы в папку tgbot98 |
| 2 | Создать config.php, вписать BOT_TOKEN, DEEPSEEK_API_KEY, ADMIN_* |
| 3 | chmod 755 data, при необходимости chown |
| 4 | Запустить: nohup php bot.php >> data/bot.log 2>&1 & |
| 5 | Проверить: pgrep -af bot.php и /son в Telegram |
| 6 | Открыть админку по новому адресу |
| 7 | (Опционально) Перенести data/ со старого сервера |
| 8 | На старом сервере: pkill -f "php bot.php" |
